### 模型假设：

1. **原料长度可切割假设：** 假设原料可以被切割成所需的长度，而且切割时没有浪费。
2. **原料数量充足假设：** 假设原料的数量是充足的，可以满足所有的生产需求。
3. **最小化原料使用量假设：** 假设单位希望最小化使用的原料数量，以降低成本。
4. **下料方式不超过三种假设：** 如果限制下料方式不超过三种，则假设这是可行的，并且不会影响到最优解的求解。

### 模型分析：

1. **目标分析：** 目标是使得使用的原材料最少，因此需要最小化所需的原料长度。
2. **约束分析：**
    - 每套钢架需要的圆钢数量和长度。
    - 原料的长度限制。

### 模型构建：

### 准备工作：

我们先求解出一共有多少种钢管切割的方式:

总共得到7种下料方式.

![[知识/杂项/作业/钢管切割问题/pictures/Untitled.png|Untitled.png]]

### 决策变量：

令 $x_i$﻿ 表示第 $i$﻿种下料方式下需要的原料数量，其中$ i = 1, 2, 3, \ldots $﻿

### 目标函数：

最小化使用的原料长度，即$ \text{min}\ z= \sum_{i} x_i$﻿

### 约束条件：

1. 每套钢架所需圆钢的数量约束：  
      
    $\begin{cases}3x_1+x_3+2x_4+x_6 \geq 100 \\ x_2+x_3+2x_4+4x_5+4x_6+6x_7 \ge 100 \\ 2x_2+x_3+x_5 \ge 100 \end{cases}$﻿

### 整数约束：

确保$ x_i $﻿是整数。

### 求解模型：

使用混合整数线性规划方法求解建立的模型，得到最优解，即使用的原材料最少的下料方案。

  

## 代码与结果:

### 求解钢管切割方式

```MATLAB
clear,clc 
M=[];
for i =0:6 
    for j=0:3 
        for k=0:2
            if i*1+j*2.1+k*2.9>=6 & i*1+j*2.1+k*2.9<=6.9
            M = [M;[i,j,k]];
            end
        end
    end
end
rows = {'1m钢管', '2.1m钢管', '2.9m钢管'};
cols = cellstr(num2str((1:size(M', 2))'));
T = array2table(M', 'RowNames', rows, 'VariableNames', cols);
disp(T);   
```

### 运行结果:

![[知识/杂项/作业/钢管切割问题/pictures/Untitled.png|Untitled.png]]

### 结果分析:

可以看出,在充分利用原材料的情况下,一共有7种不同的下料方式,我们用这七种下料方式作为基础求解最后的下料方案.

### 求解下料方案:

```MATLAB
% 创建优化变量
x1 = optimvar("x1","Type","integer","LowerBound",0);
x2 = optimvar("x2","Type","integer","LowerBound",0);
x3 = optimvar("x3","Type","integer","LowerBound",0);
x4 = optimvar("x4","Type","integer","LowerBound",0);
x5 = optimvar("x5","Type","integer","LowerBound",0);
x6 = optimvar("x6","Type","integer","LowerBound",0);
x7 = optimvar("x7","Type","integer","LowerBound",0);

% 设置求解器的初始起点
initialPoint.x1 = zeros(size(x1));
initialPoint.x2 = zeros(size(x2));
initialPoint.x3 = zeros(size(x3));
initialPoint.x4 = zeros(size(x4));
initialPoint.x5 = zeros(size(x5));
initialPoint.x6 = zeros(size(x6));
initialPoint.x7 = zeros(size(x7));

% 创建问题
problem = optimproblem;

% 定义问题目标
problem.Objective = x1+x2+x3+x4+x5+x6+x7;

% 定义问题约束
problem.Constraints.constraint1 = 3*x1+x3+2*x4+x6 >= 100;
problem.Constraints.constraint2 = x2+x3+2*x4+4*x5+4*x6+6*x7 >= 100;
problem.Constraints.constraint3 = 2*x2+x3+x5 >= 100;

% 设置非默认求解器选项
options = optimoptions("intlinprog","Display","final");

% 求解问题
[solution,objectiveValue] = solve(problem,initialPoint,"Solver","intlinprog",...
    "Options",options);
```

### 运行结果:  
  

![[知识/杂项/作业/钢管切割问题/pictures/Untitled 1.png|Untitled 1.png]]

![[知识/杂项/作业/钢管切割问题/pictures/Untitled 2.png|Untitled 2.png]]

  

### 结果分析:

运行的结果说明,最省材料的下料方案使用91根原料,

其中32根使用方式1进行切割,44根使用方式2进行切割,2根使用方式4进行切割,13根使用方式5进行切割.

在这种下料方案下,能够最节省原料.

  

## 若进一步要求下料方式不超过三种

### 添加决策变量

加入决策变量$y_i,y_i\in \{0,1\} , i=1,2,3,4,5,6,7$﻿,其中$i = 1$﻿表示采取该下料方式

### 修改约束条件

每套钢架所需的圆钢的数量约束改为:

$\begin{cases}3x_1y_1+x_3y_3+2x_4y_4+x_6y_6 \geq 100 \\ x_2y_2+x_3y_3+2x_4y_4+4x_5y_5+4x_6y_6+6x_7y_7 \ge 100 \\ 2x_2y_2+x_3y_3+x_5y_5 \ge 100 \\ \sum_{i=1}^7 y_i \le 3 \end{cases}$﻿

### 求解新模型:

使用非线性规划方法求解建立的模型，经过多次迭代取最小值，得到最优解，即使用的原材料最少的下料方案。

## 代码与结果:

### 求解最多三种下料方式的下料方案:

```MATLAB
num_iterations = 1000;
min_value = inf;
for i = 1:num_iterations
    % 设置不同的初始点或其他参数
    % 调用优化求解器，求解最优解
		% 创建优化变量
x12 = optimvar("x1","Type","integer","LowerBound",0);
x22 = optimvar("x2","Type","integer","LowerBound",0);
x32 = optimvar("x3","Type","integer","LowerBound",0,"UpperBound",50);
x42 = optimvar("x4","Type","integer","LowerBound",0,"UpperBound",30);
x52 = optimvar("x5","Type","integer","LowerBound",0,"UpperBound",50);
x62 = optimvar("x6","Type","integer","LowerBound",0,"UpperBound",50);
x72 = optimvar("x7","Type","integer","LowerBound",0,"UpperBound",30);
y1 = optimvar("y1","Type","integer","LowerBound",0,"UpperBound",1);
y2 = optimvar("y2","Type","integer","LowerBound",0,"UpperBound",1);
y3 = optimvar("y3","Type","integer","LowerBound",0,"UpperBound",1);
y4 = optimvar("y4","Type","integer","LowerBound",0,"UpperBound",1);
y5 = optimvar("y5","Type","integer","LowerBound",0,"UpperBound",1);
y6 = optimvar("y6","Type","integer","LowerBound",0,"UpperBound",1);
y7 = optimvar("y7","Type","integer","LowerBound",0,"UpperBound",1);

% 设置求解器的初始起点
initialPoint.x1 = repmat(34,size(x12));
initialPoint.x2 = repmat(43,size(x22));
initialPoint.x3 = zeros(size(x32));
initialPoint.x4 = zeros(size(x42));
initialPoint.x5 = repmat(15,size(x52));
initialPoint.x6 = zeros(size(x62));
initialPoint.x7 = zeros(size(x72));
initialPoint.y1 = ones(size(y1));
initialPoint.y2 = ones(size(y2));
initialPoint.y3 = zeros(size(y3));
initialPoint.y4 = zeros(size(y4));
initialPoint.y5 = repmat(5,size(y5));
initialPoint.y6 = zeros(size(y6));
initialPoint.y7 = zeros(size(y7));

% 创建问题
problem = optimproblem;

% 定义问题目标
problem.Objective = x12+x22+x32+x42+x52+x62+x72;

% 定义问题约束
problem.Constraints.constraint1 = 3*x12*y1+x32*y3+2*x42*y4+x62*y6 >= 100;
problem.Constraints.constraint2 = x22*y2+x32*y3+2*x42*y4+4*x52*y5+4*x62*y6+6*x72*y7 >= 100;
problem.Constraints.constraint3 = 2*x22*y2+x32*y3+x52*y5 >= 100;
problem.Constraints.constraint4 = y1+y2+y3+y4+y5+y6+y7 <= 3;

% 求解问题
solution = solve(problem,initialPoint);

% 清除变量
clearvars x12 x22 x32 x42 x52 x62 x72 y1 y2 y3 y4 y5 y6 y7 initialPoint
    fval=solution.x1+solution.x2+solution.x3+solution.x4+solution.x5+solution.x6+solution.x7;
    % 更新最小值
    if fval < min_value
        solu=solution;
        min_value = fval;
    end
end
disp(['最小值：', num2str(min_value)]);
disp(solu);
```

### 运行结果:

![[知识/杂项/作业/钢管切割问题/pictures/Untitled 3.png|Untitled 3.png]]

  

![[知识/杂项/作业/钢管切割问题/pictures/Untitled 4.png|Untitled 4.png]]

### 结果分析:

运行的结果说明,在只能使用三种下料方式的情况下,最省材料的下料方案使用92根原材料:

这种方案只使用下料方式1,下料方式2和下料方式5,

其中34根原材料使用下料方式1切割,42根原材料使用下料方式2切割,16根原材料使用下料方式5切割.

在这种下料方案下,能够在只使用三种下料方式的同时最节省原料.